<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shopping Cart - Phone Store</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
        integrity="sha512-9usAa10IRO0HhonpyAIVpjrylPvoDwiPUiKdWk5t3PyolY1cOd4DSE0Ga+ri4AuTroPR5aQvXU9xC6qOPnzFeg=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>
        /* Example CSS overrides - consider moving to style.css for consistency */
        .table-container {
            overflow-x: auto;
        }

        /* Hide scrollbar for Chrome, Safari and Opera */
        .table-container::-webkit-scrollbar {
            display: none;
        }

        /* Hide scrollbar for IE, Edge and Firefox */
        .table-container {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
    </style>
</head>

<body class="bg-gray-100 font-sans">
    <!-- Header (consistent across all pages) -->
    <header class="bg-white shadow-md">
        <nav class="container mx-auto px-4 py-3 flex items-center justify-between">
            <a href="index.html" class="text-2xl font-semibold text-gray-800">Phone Store</a>
            <div class="flex items-center space-x-4">
                <a href="index.html" class="text-gray-600 hover:text-gray-800">Home</a>
                <a href="product.html" class="text-gray-600 hover:text-gray-800">Products</a>
                <a href="contact.html" class="text-gray-600 hover:text-gray-800">Contact</a>
                <a href="cart.html" class="text-gray-600 hover:text-gray-800 relative">
                    <i class="fas fa-shopping-cart"></i>
                    <span id="cart-count"
                        class="absolute top-[-8px] right-[-8px] bg-red-500 text-white rounded-full px-2 text-xs">0</span>
                </a>
            </div>
        </nav>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto mt-8 p-4">
        <h1 class="text-3xl font-semibold mb-4 text-gray-800">Shopping Cart</h1>

        <div id="cart-items" class="table-container">
            <table class="min-w-full bg-white rounded-lg shadow-md">
                <thead class="bg-gray-50">
                    <tr>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                            Product</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                            Price</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                            Quantity</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                            Total</th>
                        <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">
                            Actions</th>
                    </tr>
                </thead>
                <tbody id="cart-body" class="divide-y divide-gray-200">
                    <!-- Cart items will be dynamically added here -->
                </tbody>
            </table>
        </div>

        <!-- Cart Summary -->
        <div class="mt-6 p-4 bg-white rounded-lg shadow-md">
            <h2 class="text-xl font-semibold mb-2 text-gray-700">Cart Summary</h2>
            <div class="flex justify-between py-2">
                <span class="text-gray-600">Subtotal:</span>
                <span id="subtotal" class="text-gray-800">$0.00</span>
            </div>
            <div class="flex justify-between py-2">
                <span class="text-gray-600">Shipping:</span>
                <span id="shipping" class="text-gray-800">$10.00</span>
            </div>
            <div class="flex justify-between py-2 font-semibold">
                <span class="text-gray-700">Total:</span>
                <span id="total" class="text-gray-900">$0.00</span>
            </div>
            <button id="checkout-button"
                class="mt-4 bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded w-full">
                Proceed to Checkout
            </button>
        </div>
    </main>

    <!-- Footer (consistent across all pages) -->
    <footer class="bg-gray-800 text-white py-4 mt-8">
        <div class="container mx-auto px-4 text-center">
            <p>&copy; 2024 Phone Store. All rights reserved.</p>
        </div>
    </footer>

    <script>
        // @ts-check
        (function () {
            /**
             * Represents an item in the shopping cart.
             * @typedef {object} CartItem
             * @property {number} id - The unique identifier of the product.
             * @property {string} name - The name of the product.
             * @property {number} price - The price of the product.
             * @property {number} quantity - The quantity of the product in the cart.
             * @property {string} image - URL of product image.
             */

            /**
             * Gets the cart items from local storage.
             * @returns {CartItem[]} - An array of cart items.
             */
            function getCartItems() {
                try {
                    const cartData = localStorage.getItem('cart');
                    return cartData ? JSON.parse(cartData) : [];
                } catch (error) {
                    console.error("Error getting cart items from local storage:", error);
                    return [];
                }
            }

            /**
             * Saves the cart items to local storage.
             * @param {CartItem[]} cartItems - An array of cart items to save.
             */
            function saveCartItems(cartItems) {
                try {
                    localStorage.setItem('cart', JSON.stringify(cartItems));
                } catch (error) {
                    console.error("Error saving cart items to local storage:", error);
                }
            }

            /**
             * Updates the cart display with the current cart items.
             */
            function updateCartDisplay() {
                const cartItems = getCartItems();
                const cartBody = document.getElementById('cart-body');
                const subtotalElement = document.getElementById('subtotal');
                const totalElement = document.getElementById('total');
                const cartCountElement = document.getElementById('cart-count');

                if (!cartBody || !subtotalElement || !totalElement || !cartCountElement) {
                    console.error("Required elements not found in the DOM.");
                    return;
                }

                // Clear existing cart items
                cartBody.innerHTML = '';

                let subtotal = 0;

                cartItems.forEach(item => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="flex items-center">
                                <div class="flex-shrink-0 h-10 w-10">
                                    <img class="h-10 w-10 rounded-full" src="${item.image}" alt="${item.name}">
                                </div>
                                <div class="ml-4">
                                    <div class="text-sm font-medium text-gray-900">${item.name}</div>
                                </div>
                            </div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="text-sm text-gray-500">$${item.price.toFixed(2)}</div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="flex items-center">
                                <button class="px-2 py-1 bg-gray-200 hover:bg-gray-300 rounded-l" onclick="decreaseQuantity(${item.id})">-</button>
                                <input type="number" class="w-16 text-center border border-gray-300 rounded focus:ring-blue-500 focus:border-blue-500 text-sm" value="${item.quantity}" min="1" data-item-id="${item.id}" onchange="updateQuantity(${item.id}, this.value)">
                                <button class="px-2 py-1 bg-gray-200 hover:bg-gray-300 rounded-r" onclick="increaseQuantity(${item.id})">+</button>
                            </div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="text-sm text-gray-500">$${(item.price * item.quantity).toFixed(2)}</div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-right">
                            <button class="text-red-500 hover:text-red-700" onclick="removeItem(${item.id})">Remove</button>
                        </td>
                    `;
                    cartBody.appendChild(row);
                    subtotal += item.price * item.quantity;
                });

                const shippingCost = 10; // Static shipping cost
                const total = subtotal + shippingCost;

                subtotalElement.textContent = '$' + subtotal.toFixed(2);
                totalElement.textContent = '$' + total.toFixed(2);

                // Update cart count in header
                cartCountElement.textContent = cartItems.length.toString();
            }

            /**
             * Increases the quantity of an item in the cart.
             * @param {number} itemId - The ID of the item to increase the quantity of.
             */
            window.increaseQuantity = function (itemId) {
                const cartItems = getCartItems();
                const itemIndex = cartItems.findIndex(item => item.id === itemId);

                if (itemIndex !== -1) {
                    cartItems[itemIndex].quantity += 1;
                    saveCartItems(cartItems);
                    updateCartDisplay();
                }
            };

            /**
             * Decreases the quantity of an item in the cart.
             * @param {number} itemId - The ID of the item to decrease the quantity of.
             */
            window.decreaseQuantity = function (itemId) {
                const cartItems = getCartItems();
                const itemIndex = cartItems.findIndex(item => item.id === itemId);

                if (itemIndex !== -1 && cartItems[itemIndex].quantity > 1) {
                    cartItems[itemIndex].quantity -= 1;
                    saveCartItems(cartItems);
                    updateCartDisplay();
                }
            };

            /**
             * Updates the quantity of an item in the cart based on user input.
             * @param {number} itemId - The ID of the item to update.
             * @param {string} newQuantity - The new quantity entered by the user.
             */
            window.updateQuantity = function (itemId, newQuantity) {
                const cartItems = getCartItems();
                const itemIndex = cartItems.findIndex(item => item.id === itemId);

                if (itemIndex !== -1) {
                    const quantity = parseInt(newQuantity, 10);
                    if (!isNaN(quantity) && quantity > 0) {
                        cartItems[itemIndex].quantity = quantity;
                        saveCartItems(cartItems);
                        updateCartDisplay();
                    } else {
                        // If the quantity is invalid, revert to the previous valid quantity.
                        updateCartDisplay();
                    }
                }
            };

            /**
             * Removes an item from the cart.
             * @param {number} itemId - The ID of the item to remove.
             */
            window.removeItem = function (itemId) {
                let cartItems = getCartItems();
                cartItems = cartItems.filter(item => item.id !== itemId);
                saveCartItems(cartItems);
                updateCartDisplay();
            };

            // Checkout button functionality
            const checkoutButton = document.getElementById('checkout-button');
            if (checkoutButton) {
                checkoutButton.addEventListener('click', function () {
                    window.location.href = 'checkout.html';
                });
            }

            // Initial cart display update
            updateCartDisplay();
        })();
    </script>
</body>

</html>